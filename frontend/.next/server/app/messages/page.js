(()=>{var e={};e.id=750,e.ids=[750],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},5205:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>g,originalPathname:()=>x,pages:()=>c,routeModule:()=>u,tree:()=>d}),t(32574),t(92902),t(12874);var s=t(27105),a=t(15265),l=t(90157),i=t.n(l),o=t(44665),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);t.d(r,n);let d=["",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,32574)),"C:\\Users\\rainf\\wip\\frontend\\app\\messages\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,92902)),"C:\\Users\\rainf\\wip\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,12874,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\rainf\\wip\\frontend\\app\\messages\\page.tsx"],x="/messages/page",g={require:t,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},90448:(e,r,t)=>{Promise.resolve().then(t.bind(t,86016))},86016:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>f});var s=t(19899),a=t(5507),l=t(76153),i=t(65559),o=t(62435),n=t(21842),d=t(37067),c=t(94767),x=t(68443),g=t(16252),u=t(2482),m=t(93244),h=t(32070),p=t(48449),y=t(54175);function b(){(0,l.useRouter)(),(0,l.useSearchParams)();let[e,r]=(0,a.useState)([]),[t,b]=(0,a.useState)(null),[f,j]=(0,a.useState)([]),[v,w]=(0,a.useState)(!0),[k,N]=(0,a.useState)(!1),[_,C]=(0,a.useState)(!1),[q,S]=(0,a.useState)(0),[Z,$]=(0,a.useState)(null),[P,M]=(0,a.useState)(!1),[A,R]=(0,a.useState)(""),[I,F]=(0,a.useState)(!1),T=async e=>{try{N(!0);let t=await n.Il.getConversation(e);j(t.reverse()),await n.Il.markConversationAsRead(e);let s=await n.Il.getAll("conversations");r(s);let a=await n.Il.getUnreadCount();S(a.count)}catch(e){console.error("Failed to fetch conversation:",e)}finally{N(!1)}},U=e=>{b(e),T(e)},D=async()=>{r(await n.Il.getAll("conversations")),S((await n.Il.getUnreadCount()).count)},E=async()=>{if(t)try{F(!0),await n.Il.reportConversation(t,A.trim()||void 0),M(!1),R(""),alert("Conversation reported successfully. Administrators will review it.")}catch(e){console.error("Failed to report conversation:",e),alert(e.response?.data?.error||"Failed to report conversation")}finally{F(!1)}},L=e=>{let r=new Date(e),t=new Date,s=t.getTime()-r.getTime(),a=Math.floor(s/6e4),l=Math.floor(s/36e5),i=Math.floor(s/864e5);return a<1?"Just now":a<60?`${a}m ago`:l<24?`${l}h ago`:i<7?`${i}d ago`:r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:r.getFullYear()!==t.getFullYear()?"numeric":void 0})},G=t?e.find(e=>e.other_user_id===t):null;return s.jsx(i.Z,{children:(0,s.jsxs)("div",{className:"relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10",children:[(0,s.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Messages"}),q>0&&(0,s.jsxs)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:[q," unread message",1!==q?"s":""]})]}),(0,s.jsxs)("button",{onClick:()=>C(!0),className:"inline-flex items-center gap-2 rounded-lg bg-corporate-blue px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-corporate-blue-dark transition-colors",children:[s.jsx(d.Z,{className:"w-4 h-4"}),"New Message"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:`lg:col-span-1 ${t?"hidden lg:block":"block"}`,children:(0,s.jsxs)("div",{className:"rounded-2xl border border-gray-200/50 dark:border-gray-700/50 bg-white/80 dark:bg-gray-900/70 shadow-xl backdrop-blur-sm overflow-hidden",children:[s.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Conversations"})}),s.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700 max-h-[calc(100vh-250px)] lg:max-h-[600px] overflow-y-auto",children:v?s.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"Loading..."}):0===e.length?(0,s.jsxs)("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:[s.jsx(c.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),s.jsx("p",{children:"No conversations yet"}),s.jsx("p",{className:"text-sm mt-1",children:"Start a new conversation to get started"})]}):e.map(e=>s.jsx("button",{onClick:()=>U(e.other_user_id),className:`w-full text-left p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors ${t===e.other_user_id?"bg-corporate-blue/10 dark:bg-corporate-blue/20 border-l-4 border-corporate-blue":""}`,children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsxs)("div",{className:"relative flex-shrink-0",children:[s.jsx("img",{src:e.other_user.profile_image_url||"/defaultpfp.jpg",alt:e.other_user.username,className:"w-12 h-12 rounded-full object-cover ring-2 ring-gray-200/50 dark:ring-gray-700/50",onError:e=>{e.currentTarget.src="/defaultpfp.jpg"}}),e.unread_count>0&&s.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-red-500 text-white text-xs font-bold flex items-center justify-center",children:e.unread_count>9?"9+":e.unread_count})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[s.jsx("p",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.other_user.player_name||e.other_user.username}),void 0!==e.other_user.last_seen_at&&s.jsx("div",{className:`flex items-center gap-1 flex-shrink-0 ${e.other_user.is_online?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"}`,children:s.jsx(x.Z,{className:`h-1.5 w-1.5 ${e.other_user.is_online?"fill-green-500":"fill-gray-400"}`})})]}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 flex-shrink-0 ml-2",children:L(e.last_message.created_at)})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:[e.last_message.subject&&(0,s.jsxs)("span",{className:"font-medium",children:[e.last_message.subject,": "]}),e.last_message.body]})]})]})},e.other_user_id))})]})}),s.jsx("div",{className:`lg:col-span-2 ${t?"block":"hidden lg:block"}`,children:t&&G?(0,s.jsxs)("div",{className:"rounded-2xl border border-gray-200/50 dark:border-gray-700/50 bg-white/80 dark:bg-gray-900/70 shadow-xl backdrop-blur-sm overflow-hidden flex flex-col h-[calc(100vh-200px)] lg:h-[600px]",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>b(null),className:"lg:hidden rounded-lg p-1 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:s.jsx(g.Z,{className:"w-5 h-5"})}),s.jsx("img",{src:G.other_user.profile_image_url||"/defaultpfp.jpg",alt:G.other_user.username,className:"w-10 h-10 rounded-full object-cover ring-2 ring-gray-200/50 dark:ring-gray-700/50",onError:e=>{e.currentTarget.src="/defaultpfp.jpg"}}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(y.default,{href:`/profile/${G.other_user.profile_id}`,className:"font-semibold text-gray-900 dark:text-white hover:text-corporate-blue transition-colors",children:G.other_user.player_name||G.other_user.username}),void 0!==G.other_user.last_seen_at&&(0,s.jsxs)("div",{className:`flex items-center gap-1 text-xs ${G.other_user.is_online?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}`,children:[s.jsx(x.Z,{className:`h-1.5 w-1.5 ${G.other_user.is_online?"fill-green-500":"fill-gray-400"}`}),s.jsx("span",{children:((e,r)=>{if(r)return"Online";if(!e)return"Offline";let t=new Date(e),s=new Date().getTime()-t.getTime(),a=Math.floor(s/6e4),l=Math.floor(s/36e5),i=Math.floor(s/864e5);return a<1?"Just now":a<60?`${a}m ago`:l<24?`${l}h ago`:i<7?`${i}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric"})})(G.other_user.last_seen_at,G.other_user.is_online)})]})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Profile #",G.other_user.profile_id]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("button",{onClick:()=>M(!0),className:"rounded-lg px-3 py-1.5 text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center gap-2",title:"Report this conversation",children:[s.jsx(u.Z,{className:"w-4 h-4"}),"Report"]}),(0,s.jsxs)("button",{onClick:()=>{C(!0)},className:"rounded-lg px-3 py-1.5 text-sm font-semibold bg-corporate-blue text-white hover:bg-corporate-blue-dark transition-colors flex items-center gap-2",children:[s.jsx(m.Z,{className:"w-4 h-4"}),"Reply"]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:k?s.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"Loading messages..."}):0===f.length?(0,s.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[s.jsx(c.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),s.jsx("p",{children:"No messages in this conversation"})]}):f.map(e=>{let r=null!==Z&&e.sender_id===Z;return s.jsx("div",{className:`flex ${r?"justify-end":"justify-start"}`,children:(0,s.jsxs)("div",{className:`max-w-[70%] rounded-lg p-3 ${r?"bg-corporate-blue text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white"}`,children:[e.subject&&s.jsx("p",{className:`font-semibold mb-1 ${r?"text-white":"text-gray-900 dark:text-white"}`,children:e.subject}),s.jsx("p",{className:`whitespace-pre-wrap ${r?"text-white":"text-gray-700 dark:text-gray-300"}`,children:e.body}),(0,s.jsxs)("div",{className:`flex items-center gap-2 mt-2 text-xs ${r?"text-white/70":"text-gray-500 dark:text-gray-400"}`,children:[s.jsx(h.Z,{className:"w-3 h-3"}),L(e.created_at)]})]})},e.id)})})]}):s.jsx("div",{className:"rounded-2xl border border-gray-200/50 dark:border-gray-700/50 bg-white/80 dark:bg-gray-900/70 shadow-xl backdrop-blur-sm h-[600px] flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:[s.jsx(c.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),s.jsx("p",{className:"text-lg font-semibold mb-2",children:"Select a conversation"}),s.jsx("p",{className:"text-sm",children:"Choose a conversation from the list to view messages"})]})})})]}),s.jsx(o.Z,{isOpen:_,onClose:()=>C(!1),recipientId:t||void 0,recipientName:G?.other_user.player_name||G?.other_user.username,onSuccess:D}),P&&G&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 p-6 max-w-md mx-4 w-full",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Report Conversation"}),s.jsx("button",{onClick:()=>{M(!1),R("")},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:s.jsx(p.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Reporting conversation with ",s.jsx("strong",{children:G.other_user.player_name||G.other_user.username})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:[s.jsx("strong",{children:"Note:"}),' This is for reporting inappropriate content or behavior. For game suggestions or bugs, please use the "Feedback & Issues" page instead.']}),(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"report-reason",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Reason (optional)"}),s.jsx("textarea",{id:"report-reason",value:A,onChange:e=>R(e.target.value),rows:4,maxLength:2e3,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-corporate-blue focus:border-transparent resize-y",placeholder:"Please provide details about why you're reporting this conversation..."}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[A.length," / 2000 characters"]})]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[s.jsx("button",{onClick:()=>{M(!1),R("")},className:"px-4 py-2 text-sm font-medium rounded-md border border-gray-200 text-gray-700 hover:bg-gray-100 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-700",disabled:I,children:"Cancel"}),s.jsx("button",{onClick:E,disabled:I,className:"px-4 py-2 text-sm font-medium rounded-md bg-red-600 text-white hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:I?"Reporting...":"Report Conversation"})]})]})})]})})}function f(){return s.jsx(a.Suspense,{fallback:s.jsx(i.Z,{children:s.jsx("div",{className:"min-h-[calc(100vh-4rem)] flex items-center justify-center",children:s.jsx("div",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Loading messages..."})})}),children:s.jsx(b,{})})}},16252:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(61278).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},2482:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(61278).Z)("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]])},37067:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(61278).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},32574:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(2772).createProxy)(String.raw`C:\Users\rainf\wip\frontend\app\messages\page.tsx#default`)}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[287,945,175,491,559,535],()=>t(5205));module.exports=s})();