# FID-20251225-004: Market UI and Business Unit Controls

**Status:** IN_PROGRESS
**Priority:** HIGH
**Complexity:** 3/5
**Created:** 2025-12-25
**Estimated:** 2h

---

## Summary

Fix four market and business unit UI/UX issues:
1. Top demanders not displaying on commodity/product pages
2. Verify electricity production units don't demand electricity (double-check FID-003 fix)
3. Move abandon button to per-business-unit level (remove sector-wide abandonment)
4. Add quantity selector (1/5/10 units) per sector with dynamic cost display

---

## Acceptance Criteria

- [ ] Commodity pages show top demanding sectors
- [ ] Product pages show top demanding sectors
- [ ] Energy sector production units confirmed NOT consuming electricity
- [ ] Each business unit has its own abandon button
- [ ] Sector-wide "Abandon Sector" option removed
- [ ] Each sector has quantity selector (1, 5, 10 units)
- [ ] Build cost updates dynamically based on selected quantity
- [ ] Abandon cost updates dynamically based on selected quantity
- [ ] Tooltip displays per-unit stats (not affected by quantity selector)
- [ ] Building 10 units builds exactly 10, abandoning 10 abandons exactly 10
- [ ] TypeScript compiles with no errors

---

## Approach

### Phase 1: Fix Top Demanders Display
1. Check backend API response for top demanders data
2. Verify frontend is receiving the data
3. Update commodity/product detail pages to display top demanders

### Phase 2: Verify Electricity Production Fix
1. Check BusinessUnitCalculator for Energy sector exclusion
2. Test that Energy production units don't consume electricity
3. Confirm only oil is consumed

### Phase 3: Per-Unit Abandon Buttons
1. Remove sector-wide abandon endpoint/button
2. Add abandon button to each business unit card
3. Update API to abandon specific unit quantities
4. Update UI to show per-unit abandon

### Phase 4: Quantity Selector with Dynamic Costs
1. Add state for quantity selector (1/5/10) per sector
2. Display selector in each sector card
3. Calculate and display dynamic build costs (quantity * unit_cost)
4. Calculate and display dynamic abandon costs (quantity * abandon_cost)
5. Ensure tooltips show per-unit stats unchanged
6. Update build/abandon handlers to use selected quantity

---

## Files

| Action | File | Purpose |
|--------|------|---------|
| MOD | `frontend/app/commodity/[name]/page.tsx` | Display top demanders |
| MOD | `frontend/app/product/[name]/page.tsx` | Display top demanders |
| MOD | `backend/src/routes/markets.ts` | Verify top demanders in API |
| TEST | `backend/src/services/BusinessUnitCalculator.ts` | Verify Energy fix |
| MOD | `frontend/components/MarketEntryCard.tsx` or similar | Add per-unit controls |
| MOD | `backend/src/routes/markets.ts` | Update abandon endpoint |

---

## Dependencies

None

---

## Notes

Issues identified:
- Top demanders data may not be populated in backend response
- Need to ensure FID-003 electricity fix is working correctly
- Current abandon is sector-wide, needs to be per business unit
- No quantity selector exists - all operations are 1 unit at a time
