# FID-20251225-009: Login/Register Page Rework

**Status:** COMPLETE
**Priority:** H
**Complexity:** 3
**Created:** 2025-12-25
**Completed:** 2025-12-25

---

## Description

Complete rework of login and registration pages with the following requirements:
1. Case-insensitive username handling (backend + frontend)
2. Password visibility toggle (show/hide password)
3. Confirm password field for registration
4. Two-step registration flow:
   - Step 1: Login credentials (username, email, password, confirm password, registration secret, admin secret)
   - Step 2: Profile info (player name, gender, age, starting state)
5. Fresh CSS styling independent of theme (standalone pages)
6. Clean, modern design from scratch

---

## Acceptance Criteria

- [x] Username lookup is case-insensitive (login with "User" matches stored "user")
- [x] Username is stored in lowercase during registration
- [x] Password field has show/hide toggle button
- [x] Registration has confirm password field with validation
- [x] Registration is split into 2 pages (credentials first, profile second)
- [x] Pages have clean, standalone CSS (not dependent on theme)
- [x] Login page has same password toggle feature
- [x] TypeScript compiles with 0 errors
- [x] Registration flow works end-to-end
- [x] Login flow works with case-insensitive usernames

---

## Implementation Summary

### Backend Changes
1. Modified `UserModel.findByUsername()` to use `LOWER()` for case-insensitive lookup
2. Updated `UserModel.create()` to store username as lowercase
3. Updated username uniqueness check in auth.ts to be case-insensitive

### Frontend Changes
1. Created new standalone login page with:
   - Fresh CSS styling (independent of theme)
   - Password visibility toggle
   - Case-insensitive username hint
   - Modern gradient background design

2. Created two-step registration flow:
   - Step 1 (`/register`): Credentials form with:
     - Username, email, password, confirm password
     - Password validation indicators
     - Registration secret, admin secret fields
     - Step progress indicator
   - Step 2 (`/register/profile`): Profile form with:
     - Player name, gender, age, starting state
     - Back button to return to step 1
     - Submits full registration on completion

3. Created reusable PasswordInput component with visibility toggle

---

## Files Modified/Created

### Backend
- `backend/src/models/User.ts` - Case-insensitive username lookup, lowercase storage
- `backend/src/routes/auth.ts` - Case-insensitive username uniqueness check

### Frontend
- `frontend/app/login/page.tsx` - Complete rewrite with new styling
- `frontend/app/register/page.tsx` - Step 1: Credentials form
- `frontend/app/register/profile/page.tsx` - Step 2: Profile form (NEW)
- `frontend/components/auth/PasswordInput.tsx` - Reusable password component (NEW)

### Dev
- `dev/fids/FID-20251225-009.md` - This FID document

---

## LOC Summary

| File | Lines |
|------|-------|
| login/page.tsx | 361 |
| register/page.tsx | 573 |
| register/profile/page.tsx | 393 |
| PasswordInput.tsx | 52 |
| User.ts (changes) | ~5 |
| auth.ts (changes) | ~2 |
| **Total** | ~1,386 |

---

## TypeScript Status

- Frontend: 0 errors
- Backend: Pre-existing errors in sectors.ts (unrelated to this feature)

---

## Notes

- Old AuthForm component is no longer imported and can be removed in cleanup
- Registration data is passed between steps via sessionStorage
- Each page has self-contained CSS using styled-jsx global styles
- Design uses consistent color palette (blue for login, green for register step 1, purple for step 2)
